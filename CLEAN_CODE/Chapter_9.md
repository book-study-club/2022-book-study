# 9. 단위 테스트

테스트 코드는 필수

## 9.1. 세 가지 TDD 법칙

1. 실패하는 단위 테스트를 반드시 먼저 작성
1. 단위 테스트는 런타임에서만 실패하도록 작성
1. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성

다만 이로 인해 유지보수 비용이 높아지는 경우가 있음

## 9.2. 깨끗한 테스트 코드

테스트 코드 또한 실제 코드와 동일한 품질로 짜야 함

- 변경이 어렵고 그저 돌아가기만 하는 낮은 품질의 테스트 코드 -> 이는 없는 것만 못 함
- 실제 코드는 진화하는데, 테스트 코드가 이를 따라가지 못하게 됨
- 결국 테스트 코드를 폐기해버리는 상황까지 오게 됨
- 그러나 테스트 코드가 없다면 실제 코드의 변경이 어려워지고 결함율이 높아지게 됨

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다

- 테스트 케이스는 변경에 대한 부담과 비용을 많이 낮춰줌
- 따라서 테스트 케이스 또한 실제 코드의 변경에 유연하도록 구성해야 함

## 9.3. 깨끗한 테스트 코드

- 필요한 것 = 가독성, 가독성, 가독성
- 실제 테스트와 관련된 코드만 넣어야 함
- 테스트 작성 시에도 클린 코드 기법을 적용
- build-operate-check 패턴을 사용해보자 (괄호 안의 내용을 주석으로 작성)

  ```ts
  test('test getPageHHierarchyAsXml()', () => {
    // given
    makePages();

    // when
    submitRequest();

    // then
    assetResponseIsXML();
    assetResponseContains('<name>test</name>');
  })
  ```

  - build : 테스트 자료를 만듦 (given)
  - operate : 테스트 자료를 조작 (when)
  - check : 조작한 결과를 확인 (then)

### 테스트 시에도 도메인 특화 언어(DSL, Domain Specific Language)를 사용하라

- DSL : 특정 도메인의 개념과 규칙을 따르는 방식
  - 테스트용 DSL을 정의해 사용하라는 것
- 이를 사용하게 되면 해당 기능의 개발자는 테스트 코드를 쉽고 빠르게 이해할 수 있게 됨

### 이중 표준

- 테스트 코드는 효율보다 가독성을 우선시
- 심지어 테스트 코드에서만 존재할 룰(표준)이 존재해도 됨

## 9.4. 1 test = 1 concept

- 테스트 하나 당 하나의 개념(concept)만을 테스트하도록 함
- 중복되는 코드는 template method 패턴을 사용
  - given/when을 제공하는 메서드를 정의 -> 이를 사용해 테스트에서 then

## 9.5. FIRST 규칙

깨끗한 테스트가 따르는 다섯 가지 규칙

### Fast

- 테스트 코드는 (효율을 중요시하지 않더라도)빠른 속도로 동작해야 함
- 자주 테스트해야 하니까

### Independent

- 각 테스트는 서로 의존적이면 안 됨
- 어떤 순서로 실행해도 괜찮아야 함
- 서로 의존적이면 앞서 실행된 테스트 실패 시 이후 테스트도 모두 실패해버리기 때문 (에러 찾기가 어려워짐)

### Repeatable

- 테스트는 어떤 환경에서도 반복 가능해야 함

### Self-validating

- 테스트 결과는 assertion을 통해서만 알 수 있어야 함
- 절대로 수작업으로 그 결과를 알아서는 안 됨

### Timely

- 테스트는 반드시 실제 코드를 작성하기 전 작성되어야 함
  - 작성된 코드가 테스트 어렵다는 것을 너무 뒤늦게 알 수도 있고
  - 그냥 통과될 테스트 코드만 작성해버릴 수 있기 때문
